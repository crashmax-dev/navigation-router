(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function i(a,t,...e){const o=document.createElement(a);return t instanceof Node?o.append(t):typeof t=="string"?o.append(l(t)):Array.isArray(t)?o.append(...t):(Object.assign(o,t),Object.assign(o.style,t?.style)),o.append(...e),o}function l(a){return document.createTextNode(a)}class p{base;constructor(t=""){this.base=t.endsWith("/")&&t!=="/"?t.slice(0,-1):t}getLocation(){const{pathname:t,search:e,hash:o}=window.location;return((t.startsWith(this.base)?t.slice(this.base.length):t)||"/")+e+o}listen(t){const e=window.navigation;if(e){const n=r=>{!r.canIntercept||r.hashChange||r.downloadRequest||r.intercept({handler:async()=>{const s=new URL(r.destination.url),h=s.pathname.startsWith(this.base)?s.pathname.slice(this.base.length):s.pathname;t((h||"/")+s.search+s.hash)}})};return e.addEventListener("navigate",n),()=>e.removeEventListener("navigate",n)}const o=()=>t(this.getLocation());return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)}navigate(t,e){const o=this.createHref(t);window.navigation?window.navigation.navigate(o,{history:e?"replace":"push"}):(e?window.history.replaceState(null,"",o):window.history.pushState(null,"",o),window.dispatchEvent(new PopStateEvent("popstate")))}go(t){window.navigation?t>0?window.navigation.forward():window.navigation.back():window.history.go(t)}createHref(t){return this.base+t}}function d(a){return a.replace(/:([^/]+)/g,":$1")}class g{config;adapter;routes=new Map;routesByName=new Map;urlPatterns=new Map;currentRoute;currentElement;navigationLinks=new Map;constructor(t){this.config=t,this.adapter=t.adapter,this.init()}init(){for(const t of this.config.routes){const e=new t;this.routes.set(e.props.path,e),e.props.name&&this.routesByName.set(e.props.name,e);const o=d(e.props.path),n=new URLPattern({pathname:o});this.urlPatterns.set(n,e)}this.renderNavigation(),this.adapter.listen(t=>{this.handleNavigation(t)}),this.handleNavigation(this.adapter.getLocation())}renderNavigation(){const t=this.config.navigationRoot();if(!t){console.warn("[renderNavigation] Navigation container not found");return}t.innerHTML="",this.navigationLinks.clear();for(const e of this.routes.values()){if(e.props.path.includes(":"))continue;const o=this.config.navigationRenderLink(e),n=o instanceof HTMLAnchorElement?o:o.querySelector("a");n&&(n.href=this.adapter.createHref(e.props.path),n.textContent=e.props.label||e.props.name||e.props.path,n.addEventListener("click",r=>{r.ctrlKey||r.metaKey||r.altKey||r.shiftKey||(r.preventDefault(),this.push(e.props.path))})),this.navigationLinks.set(e.props.path,n||o),t.appendChild(o)}}async handleNavigation(t){const e=this.config.renderRoot();if(!e){console.warn("[handleNavigation] Root container not found");return}const o=new URL(t,location.origin),n=this.findRoute(o);if(!n){console.warn("[handleNavigation] Route not found:",o);return}const r={query:Object.fromEntries(o.searchParams),params:n.params,router:this};this.currentRoute?.unmount&&this.currentRoute.unmount();const s=n.route.mount(r)??n.route.el;if(!s){console.warn("[handleNavigation] Route element is not defined:",n.route.props);return}this.currentElement&&e.removeChild(this.currentElement),this.currentRoute&&(this.currentRoute.el=void 0),e.appendChild(s),this.currentRoute=n.route,this.currentElement=s,this.updateActiveLink()}updateActiveLink(){this.navigationLinks.forEach((t,e)=>{e===this.currentRoute?.props.path?t.classList.add("active"):t.classList.remove("active")})}findRoute(t){for(const[e,o]of this.urlPatterns.entries()){const n=e.exec({pathname:t.pathname});if(n)return{route:o,params:n.pathname.groups}}}push(t){this.adapter.navigate(t)}replace(t){this.adapter.navigate(t,!0)}back(){this.adapter.go(-1)}forward(){this.adapter.go(1)}getUnsafe(t){let e;if("name"in t?e=this.routesByName.get(t.name):e=this.routes.get(t.path),!e){console.warn("[getUnsafe] Route not found:",t);return}return e}}function m(a){return new g(a)}class c{el;props;constructor(t){this.props=t}}class f extends c{constructor(){super({path:"/about",label:"About"})}mount(t){return i("div",[i("h1","About Page"),i("p","This is the about page."),i("pre",`Timestamp: ${t.query.timestamp}`),i("button",{onclick(){t.router.back()}},"Go back")])}}class v extends c{constructor(){super({path:"/blog/:id"})}mount(t){const e=t.params.id;this.el=i("div",[i("h1","Blog Page"),i("p",`Blog ID: ${e}`),i("button",{onclick(){t.router.back()}},"Go back"),i("button",{onclick(){t.router.push(`/blog/${Number(e)+1}`)}},"Go to next blog")])}}class w extends c{cursorPointer;constructor(){super({path:"/",label:"Home"}),this.handleClick=this.handleClick.bind(this),this.handleMove=this.handleMove.bind(this)}handleClick(){console.info("Home clicked!")}handleMove(t){this.cursorPointer.textContent=`x: ${t.clientX} y: ${t.clientY}`,console.log("Mouse moved! ðŸŽ‰")}mount(t){this.cursorPointer=i("pre","x: 0 y: 0"),this.el=i("div",[i("h1","Home Page"),i("p","Welcome back!"),this.cursorPointer,i("div",[i("button",{onclick:this.handleClick},"Click me!"),i("button",{onclick(){t.router.push(`/about?timestamp=${Date.now()}`)}},"Go to About"),i("button",{onclick(){t.router.push("/blog/1")}},"Go to Blog")])]),document.body.addEventListener("mousemove",this.handleMove)}unmount(){document.body.removeEventListener("mousemove",this.handleMove)}}const u=m({adapter:new p("/navigation-router/"),routes:[w,f,v],renderRoot:()=>document.querySelector("#app"),navigationRoot:()=>document.querySelector("#navigation"),navigationRenderLink:()=>i("a",{className:"link"})});console.log(u);window.$router=u;
